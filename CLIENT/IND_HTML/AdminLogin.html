<!DOCTYPE html>
<html lang="ca">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accés a Administració</title>
    <?!= include('CSS'); ?>
</head>
<body class="page-login">
    <canvas id="particle-canvas"></canvas>
    <div class="container">
        <div id="login-form">
            <h2>Accés d'Administrador</h2>
            <form id="admin-code-form">
                <input type="password" id="admin-code" placeholder="Codi d'accés" required>
                <button type="submit">Entrar</button>
            </form>
            <div id="status-message"></div>
        </div>
    </div>

    <script>
        document.getElementById('admin-code-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const code = document.getElementById('admin-code').value;
            const statusDiv = document.getElementById('status-message');
            statusDiv.innerHTML = 'Verificant...';
            statusDiv.className = '';

            google.script.run
                .withSuccessHandler(onVerificationSuccess)
                .withFailureHandler(onFailure)
                .verifyAdminCode(code);
        });

        function onVerificationSuccess(response) {
            if (response.status === 'ok') {
                // Redirigeix al panell d'admin si el codi és correcte
                window.location.href = '<?= getScriptUrl() ?>?page=Admin';
            } else {
                const statusDiv = document.getElementById('status-message');
                statusDiv.className = 'error';
                statusDiv.textContent = response.message || 'Codi incorrecte.';
            }
        }

        function onFailure(error) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.className = 'error';
            statusDiv.textContent = 'Error: ' + error.message;
        }
    </script>
    <?!= include('BACKGROUND'); ?>
</body>
</html>